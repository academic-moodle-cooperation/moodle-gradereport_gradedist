{"version":3,"file":"gradedist.min.js","sources":["../src/gradedist.js"],"sourcesContent":["// This file is part of mod_checkmark for Moodle - http://moodle.org/\r\n//\r\n// It is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// It is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * gradedist.js\r\n *\r\n * @package\r\n * @author    Andreas Krieger\r\n * @copyright 2014-2018 Academic Moodle Cooperation {@link http://www.academic-moodle-cooperation.org}\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\n /**\r\n  * @module gradereport_gradedist/gradedist\r\n  */\r\n\r\ndefine(['jquery', 'core/log', 'core/str', 'gradereport_gradedist/config'],\r\nfunction($, log, str) {\r\n    /**\r\n     * @constructor\r\n     * @alias module:gradereport_gradedist/gradedist\r\n     */\r\n    var Gradedist = function() {\r\n    };\r\n\r\n    /*\r\n     * update() updates the chart according to the values currently set in the form\r\n     *\r\n     * @return true if everything's allright (no error handling by now)\r\n     */\r\n    Gradedist.prototype.update = function(o) {\r\n\r\n        var data = JSON.parse(o.responseText);\r\n\r\n        if (data.updateall == 1) {\r\n            window.absolut = [];\r\n            window.percent = [];\r\n\r\n            $.map(data.letters, function(letter) {\r\n                window.absolut.push(data.actdist[letter].count);\r\n                window.percent.push(data.actdist[letter].percentage);\r\n            });\r\n\r\n            var values = (window.mode == 1) ? window.percent : window.absolut;\r\n\r\n            window.chart.data.datasets[0].data = values;\r\n            window.chart.options.title.text = [data.title, \"\"];\r\n        }\r\n\r\n        window.absolutnew = [];\r\n        window.percentnew = [];\r\n\r\n        $.map(data.letters, function(letter) {\r\n            window.absolutnew.push(data.newdist[letter].count);\r\n            window.percentnew.push(data.newdist[letter].percentage);\r\n        });\r\n\r\n        instance.coverage(data);\r\n        var newvalues = (window.mode == 1) ? window.percentnew : window.absolutnew;\r\n        window.chart.data.datasets[1].data = newvalues;\r\n        window.chart.update();\r\n\r\n        return true;\r\n    };\r\n\r\n    /*\r\n     * validate() checks if the current boundaries given in the form data are\r\n     * syntactically and semantically correct and displays warnings based on this\r\n     *\r\n     * @return true if everything's allright, false on detected error\r\n     */\r\n    Gradedist.prototype.validate = function() {\r\n\r\n        var error = false;\r\n\r\n        var errdec = false;\r\n        var errint = false;\r\n        var errpre = false;\r\n        var erremp = false;\r\n\r\n        var errdecdiv = $('#b_decimals').first();\r\n        var errintdiv = $('#b_interval').first();\r\n        var errprediv = $('#b_predecessor').first();\r\n\r\n        var decimals = /^\\d+([.]\\d{1,2})?$/;\r\n        var pre = 100.01;\r\n\r\n        $.each(window.boundaries, function(id, boundary) {\r\n            var value = boundary.value.replace(/,/g, '.');\r\n            if (value != '') {\r\n                if (!decimals.test(value)) {\r\n                    errdec = true;\r\n                }\r\n                if (Number(value) > 100) {\r\n                    errint = true;\r\n                }\r\n                if (Number(value) >= Number(pre)) {\r\n                    errpre = true;\r\n                }\r\n\r\n                pre = value;\r\n            } else {\r\n                erremp = true;\r\n            }\r\n        });\r\n\r\n        if (errdec) {\r\n            if (!errdecdiv.length) {\r\n                str.get_string('decimals', 'gradereport_gradedist').done(function(s) {\r\n                    $('#boundary_error_container').first().append('<div class=\"b_error\" id=\"b_decimals\"><span>'\r\n                        + s + '</span></div>');\r\n                });\r\n            }\r\n            error = true;\r\n        } else if (errdecdiv.length) {\r\n            errdecdiv.remove();\r\n        }\r\n        if (errint) {\r\n            if (!errintdiv.length) {\r\n                str.get_string('interval', 'gradereport_gradedist').done(function(s) {\r\n                    $('#boundary_error_container').first().append('<div class=\"b_error\" id=\"b_interval\"><span>'\r\n                        + s + '</span></div>');\r\n                });\r\n            }\r\n            error = true;\r\n        } else if (errintdiv.length) {\r\n            errintdiv.remove();\r\n        }\r\n        if (errpre) {\r\n            if (!errprediv.length) {\r\n                str.get_string('predecessor', 'gradereport_gradedist').done(function(s) {\r\n                    $('#boundary_error_container').first().append('<div class=\"b_error\" id=\"b_predecessor\"><span>'\r\n                        + s + '</span></div>');\r\n                });\r\n            }\r\n            error = true;\r\n        } else if (errprediv.length) {\r\n            errprediv.remove();\r\n        }\r\n\r\n        if (window.submit.length) {\r\n            window.submit.prop('disabled', error || erremp);\r\n        }\r\n\r\n        return !error;\r\n    };\r\n\r\n    /*\r\n     * coverage() determines how many grades are covered/not covered by\r\n     * the current forms grade distribution and displays this information\r\n     *\r\n     * @return true if everything's allright, false on detected error\r\n     */\r\n    Gradedist.prototype.coverage = function(data) {\r\n\r\n        var error = false;\r\n        var erremp = false;\r\n        var errcov = Number(data.newcoverage[0]) != 0;\r\n        var errcovdiv = $('#b_coverage').first();\r\n\r\n        $.each(window.boundaries, function(id, boundary) {\r\n            if (boundary.value == '') {\r\n                erremp = true;\r\n            }\r\n        });\r\n\r\n        if (!erremp && errcov) {\r\n            if (!errcovdiv.length) {\r\n                str.get_string('coverage', 'gradereport_gradedist').done(function(s) {\r\n                    $('#boundary_error_container').first().append('<div class=\"b_error\" id=\"b_coverage\"><span>'\r\n                        + s + '</span><span class=\"newcoverage\">'\r\n                        + data.newcoverage[0] + '/' + data.newcoverage[1] + '</span></div>');\r\n                });\r\n            }\r\n            error = true;\r\n        } else if (errcovdiv.length) {\r\n            errcovdiv.remove();\r\n        }\r\n\r\n        $('.actcoverage').html(data.actcoverage[0] + '/' + data.actcoverage[1] + ' (' + data.actcoverage[2] + '%)');\r\n        $('.newcoverage').html(data.newcoverage[0] + '/' + data.newcoverage[1] + ' (' + data.newcoverage[2] + '%)');\r\n\r\n        return !error;\r\n    };\r\n\r\n    Gradedist.prototype.initChart = function(initdata, letters) {\r\n\r\n        var tofetch = [\r\n            {key: 'gradeletter', component: 'gradereport_gradedist'},\r\n            {key: 'absolut', component: 'gradereport_gradedist'},\r\n            {key: 'percent', component: 'gradereport_gradedist'},\r\n            {key: 'printchart', component: 'gradereport_gradedist'},\r\n            {key: 'downloadpng', component: 'gradereport_gradedist'},\r\n            {key: 'downloadjpeg', component: 'gradereport_gradedist'},\r\n            {key: 'downloadpdf', component: 'gradereport_gradedist'},\r\n            {key: 'downloadsvg', component: 'gradereport_gradedist'},\r\n            {key: 'downloadjpeg', component: 'gradereport_gradedist'},\r\n            {key: 'contextbuttontitle', component: 'gradereport_gradedist'},\r\n        ];\r\n\r\n\r\n\r\n        str.get_strings(tofetch).done(function(s) {\r\n            window.chart = new window.Chart($(\"#chart_container\"), {\r\n                type: 'bar',\r\n                data: {\r\n                    labels: letters,\r\n                    datasets: [{\r\n                        data: window.absolut,\r\n                        backgroundColor: '#990000',\r\n                        borderWidth: 1,\r\n                    },\r\n                    {\r\n                        data: window.absolutnew,\r\n                        backgroundColor: '#33cc33',\r\n                        borderWidth: 1\r\n                    }]\r\n                },\r\n                options: {\r\n                    title: {\r\n                        display: true,\r\n                        text: [initdata.title, \"\"],\r\n                        fontSize: 18,\r\n                        fontStyle: 'normal'\r\n                    },\r\n                    scales: {\r\n                        yAxes: [{\r\n                            ticks: {\r\n                                beginAtZero: true,\r\n                                //maxTicksLimit: 6,\r\n                                padding: 10\r\n                            },\r\n                            scaleLabel: {\r\n                                display: true,\r\n                                labelString: s[1],\r\n                                fontColor: \"#4d759e\",\r\n                                fontSize: 15\r\n                            },\r\n                            gridLines: {\r\n                                drawBorder: false,\r\n                                lineWidth: 0.3,\r\n                                color: '#000000',\r\n                                zeroLineColor: '#c0e0d0'\r\n                            },\r\n                        }],\r\n                        xAxes: [{\r\n                            scaleLabel: {\r\n                                display: true,\r\n                                labelString: s[0],\r\n                                fontColor: \"#4d759e\",\r\n                                fontSize: 15\r\n                            },\r\n                            gridLines: {\r\n                                drawOnChartArea: false,\r\n\r\n                            },\r\n                            barPercentage: 0.8\r\n                        }]\r\n                    },\r\n                    legend: {\r\n                        display: false\r\n                    },\r\n                    plugins: {\r\n                        datalabels: {\r\n                            anchor: 'end',\r\n                            align: 'top',\r\n                            color: '#000000'\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        });\r\n    };\r\n\r\n    var instance = new Gradedist();\r\n\r\n    /*\r\n     * initializer(config) prepares settings form for JS-functionality\r\n     */\r\n    instance.initializer = function(config) {\r\n\r\n        log.info('Initialize settings JS', 'gradedist');\r\n\r\n        require(['canvastoBlob']); // load canvastoBlob\r\n        var initdata = config.data;\r\n\r\n        window.mode = 0;\r\n        var letters = initdata.letters;\r\n\r\n        window.absolut = [];\r\n        window.percent = [];\r\n        window.absolutnew = [];\r\n        window.percentnew = [];\r\n\r\n        var submitSelector = \"#id_submitbutton\";\r\n        window.submit = $(submitSelector);\r\n        if (window.submit.length) {\r\n            window.submit.prop('disabled', true);\r\n        }\r\n\r\n        $.map(letters, function(letter) {\r\n            window.absolut.push(initdata.actdist[letter].count);\r\n            window.percent.push(initdata.actdist[letter].percentage);\r\n            window.absolutnew.push(initdata.newdist[letter].count);\r\n            window.percentnew.push(initdata.newdist[letter].percentage);\r\n        });\r\n\r\n        window.chart = [];\r\n\r\n        require(['ChartDataLabels'], function() {\r\n            window.Chart.plugins.register({\r\n                beforeDraw: function(chartInstance) {\r\n                    var ctx = chartInstance.chart.ctx;\r\n                    ctx.fillStyle = \"white\";\r\n                    ctx.fillRect(0, 0, chartInstance.chart.width, chartInstance.chart.height);\r\n                }\r\n            });\r\n            instance.initChart(initdata, letters);\r\n        });\r\n\r\n        var uri = M.cfg.wwwroot + '/grade/report/gradedist/ajax_handler.php?id=' + initdata.courseid;\r\n\r\n        var cfg = {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'\r\n            },\r\n            complete: function(arg1) { instance.update(arg1); },\r\n            url: uri\r\n        };\r\n\r\n        var gradeitemsSelector = \"#id_gradeitem\";\r\n        var gradeitems = $(gradeitemsSelector).first();\r\n        gradeitems.change(instance, function() {\r\n            var success = $('.alert-success');\r\n            if (success) {\r\n                success.remove();\r\n            }\r\n            cfg.data = $('#letterform').serialize() + \"&updateall=1\";\r\n            $.ajax(cfg);\r\n        });\r\n\r\n        var coursegroupsSelector = \"#id_coursegroup\";\r\n        var coursegroups = $(coursegroupsSelector).first();\r\n        if (coursegroups) {\r\n            coursegroups.change(instance, function() {\r\n                var success = $('.alert-success');\r\n                if (success) {\r\n                    success.remove();\r\n                }\r\n                $('#id_coursegrouping').first().prop('value', '0');\r\n                cfg.data = $('#letterform').serialize() + \"&updateall=1\";\r\n                $.ajax(cfg);\r\n            });\r\n        }\r\n\r\n        var coursegroupingsSelector = \"#id_coursegrouping\";\r\n        var coursegroupings = $(coursegroupingsSelector).first();\r\n        if (coursegroupings) {\r\n            coursegroupings.change(instance, function() {\r\n                var success = $('.alert-success');\r\n                if (success) {\r\n                    success.remove();\r\n                }\r\n                $('#id_coursegroup').first().prop('value', '0');\r\n                cfg.data = $('#letterform').serialize() + \"&updateall=1\";\r\n                $.ajax(cfg);\r\n            });\r\n        }\r\n\r\n        window.boundaries = $('.gradeboundaries_new input[type=text], #fgroup_id_grp_gradeboundaries_new input[type=text]');\r\n        window.boundaries.change(instance, function() {\r\n            var notifications =\r\n                    $('#page-grade-report-gradedist-index .notifyproblem, #page-grade-report-gradedist-index .notifysuccess');\r\n            if (notifications) {\r\n                notifications.remove();\r\n            }\r\n            var success = $('.alert-success');\r\n            if (success) {\r\n                success.remove();\r\n            }\r\n            if (instance.validate()) {\r\n                cfg.data = $('#letterform').serialize() + \"&updateall=1\";\r\n                $.ajax(cfg);\r\n            }\r\n        });\r\n\r\n        var desc = $('input[name^=\"grp_description\"]');\r\n        desc.change(instance, function() {\r\n            window.mode = this.value;\r\n            var values, values_new;\r\n\r\n            var s_y;\r\n            var ext_y;\r\n            if (window.mode == 1) {\r\n                values = window.percent;\r\n                values_new = window.percentnew;\r\n                s_y = 'percent';\r\n                ext_y = 100;\r\n            } else {\r\n                values = window.absolut;\r\n                values_new = window.absolutnew;\r\n                s_y = 'absolut';\r\n                ext_y = Math.max(Math.max.apply(this, window.absolut),Math.max.apply(this, window.absolutnew));\r\n            }\r\n\r\n            str.get_string(s_y, 'gradereport_gradedist').done(function(s) {\r\n                window.chart.options.scales.yAxes[0].scaleLabel.labelString = s;\r\n                window.chart.options.scales.yAxes[0].ticks.suggestedMax = ext_y;\r\n\r\n                window.chart.data.datasets[0].data = values;\r\n                window.chart.data.datasets[1].data = values_new;\r\n                window.chart.update();\r\n            });\r\n        });\r\n\r\n        var cols = $('#id_grp_columns_actualcolumns, #id_grp_columns_newcolumns');\r\n        cols.click(instance, function() {\r\n            var column = (this.id === 'id_grp_columns_actualcolumns') ? 0 : 1;\r\n            if (this.checked) {\r\n                window.chart.data.datasets[column].hidden = false;\r\n                window.chart.update();\r\n            } else {\r\n                window.chart.data.datasets[column].hidden = true;\r\n                window.chart.update();\r\n            }\r\n        });\r\n\r\n        var toprint = $('.grgd_print');\r\n        var $printframe = $('#printframe');\r\n        toprint.click(instance, function() {\r\n            var imagePath = document.getElementById('chart_container').toDataURL(\"image/png\");\r\n            var content = '<!DOCTYPE html>' +\r\n                  '<html>' +\r\n                  '<head><title></title><script></script></head>' +\r\n                  '<body onload=\"\">' +\r\n                  '<img src=\"' + imagePath + '\" style=\"width: 100%;\" />' +\r\n                  '</body>' +\r\n                  '</html>';\r\n            $printframe[0].contentWindow.document.write(content);\r\n            setTimeout(function() { $printframe[0].contentWindow.print();}, 200);\r\n        });\r\n\r\n\r\n        var topdf = $('.grgd_pdf');\r\n        topdf.click(instance, function() {\r\n            require(['html2pdf'], function(html2pdf) {\r\n                var container = document.getElementById('chart_container');\r\n                var positionInfo = container.getBoundingClientRect();\r\n                var contheight = positionInfo.height;\r\n                var contwidth = positionInfo.width;\r\n                var opt = {\r\n                  margin:       1,\r\n                  filename:     'chart.pdf',\r\n                  image:        { type: 'png'},\r\n                  pagebreak:    { mode: 'avoid-all' },\r\n                  html2canvas:  { backgroundColor: '#ffffff'},\r\n                  jsPDF:        { unit: 'px', format: [contwidth,contheight*1.1], orientation: 'landscape' }\r\n                };\r\n                html2pdf(container, opt);\r\n            });\r\n        });\r\n\r\n        var topng = $('.grgd_png');\r\n        topng.click(instance, function() {\r\n            // Cross-browser compatibility (with IE 11) required.\r\n            require(['filesaver'],\r\n                function(saveAs) {\r\n                // Cross-browser compatibility (with IE 11) required.\r\n                $(\"#chart_container\").get(0).toBlob(function(blob) {\r\n                    saveAs(blob, \"chart.png\");\r\n                });\r\n            });\r\n        });\r\n\r\n        var tojpg = $('.grgd_jpg');\r\n        tojpg.click(instance, function() {\r\n            require(['filesaver'],\r\n                function(saveAs) {\r\n                // Cross-browser compatibility (with IE 11) required.\r\n                $(\"#chart_container\").get(0).toBlob(function(blob) {\r\n                    saveAs(blob, \"chart.jpg\");\r\n                }, \"image/jpeg\");\r\n            });\r\n        });\r\n\r\n        var toxlsx = $('.grgd_xlsx');\r\n        toxlsx.click(instance, function() {\r\n            $(\"input[name='grp_export']\").val('xlsx');\r\n            $('#letterform').submit();\r\n        });\r\n\r\n        var toods = $('.grgd_ods');\r\n        toods.click(instance, function() {\r\n            $(\"input[name='grp_export']\").val('ods');\r\n            $('#letterform').submit();\r\n        });\r\n\r\n        var tocsv = $('.grgd_csv');\r\n        tocsv.click(instance, function() {\r\n            $(\"input[name='grp_export']\").val('csv');\r\n            $('#letterform').submit();\r\n        });\r\n\r\n        $('#letterform input[type=\"submit\"]').click(function() {\r\n            setTimeout(function() {instance.validate();}, 1000);\r\n        });\r\n\r\n        instance.validate();\r\n    };\r\n\r\n    return instance;\r\n});\r\n"],"names":["define","$","log","str","Gradedist","prototype","update","o","data","JSON","parse","responseText","updateall","window","absolut","percent","map","letters","letter","push","actdist","count","percentage","values","mode","chart","datasets","options","title","text","absolutnew","percentnew","newdist","instance","coverage","newvalues","validate","error","errdec","errint","errpre","erremp","errdecdiv","first","errintdiv","errprediv","decimals","pre","each","boundaries","id","boundary","value","replace","test","Number","length","get_string","done","s","append","remove","submit","prop","errcov","newcoverage","errcovdiv","html","actcoverage","initChart","initdata","get_strings","key","component","Chart","type","labels","backgroundColor","borderWidth","display","fontSize","fontStyle","scales","yAxes","ticks","beginAtZero","padding","scaleLabel","labelString","fontColor","gridLines","drawBorder","lineWidth","color","zeroLineColor","xAxes","drawOnChartArea","barPercentage","legend","plugins","datalabels","anchor","align","initializer","config","info","require","register","beforeDraw","chartInstance","ctx","fillStyle","fillRect","width","height","cfg","method","headers","complete","arg1","url","M","wwwroot","courseid","change","success","serialize","ajax","coursegroups","coursegroupings","notifications","values_new","s_y","ext_y","this","Math","max","apply","suggestedMax","click","column","checked","hidden","toprint","$printframe","content","document","getElementById","toDataURL","contentWindow","write","setTimeout","print","html2pdf","container","positionInfo","getBoundingClientRect","contheight","margin","filename","image","pagebreak","html2canvas","jsPDF","unit","format","orientation","saveAs","get","toBlob","blob","val"],"mappings":";;;;;;;;AA4BAA,yCAAO,CAAC,SAAU,WAAY,WAAY,iCAC1C,SAASC,EAAGC,IAAKC,KAKb,IAAIC,UAAY,aAQhBA,UAAUC,UAAUC,OAAS,SAASC,GAElC,IAAIC,KAAOC,KAAKC,MAAMH,EAAEI,cAExB,GAAsB,GAAlBH,KAAKI,UAAgB,CACrBC,OAAOC,QAAU,GACjBD,OAAOE,QAAU,GAEjBd,EAAEe,IAAIR,KAAKS,SAAS,SAASC,QACzBL,OAAOC,QAAQK,KAAKX,KAAKY,QAAQF,QAAQG,OACzCR,OAAOE,QAAQI,KAAKX,KAAKY,QAAQF,QAAQI,WAC7C,IAEA,IAAIC,OAAyB,GAAfV,OAAOW,KAAaX,OAAOE,QAAUF,OAAOC,QAE1DD,OAAOY,MAAMjB,KAAKkB,SAAS,GAAGlB,KAAOe,OACrCV,OAAOY,MAAME,QAAQC,MAAMC,KAAO,CAACrB,KAAKoB,MAAO,GACnD,CAEAf,OAAOiB,WAAa,GACpBjB,OAAOkB,WAAa,GAEpB9B,EAAEe,IAAIR,KAAKS,SAAS,SAASC,QACzBL,OAAOiB,WAAWX,KAAKX,KAAKwB,QAAQd,QAAQG,OAC5CR,OAAOkB,WAAWZ,KAAKX,KAAKwB,QAAQd,QAAQI,WAChD,IAEAW,SAASC,SAAS1B,MAClB,IAAI2B,UAA4B,GAAftB,OAAOW,KAAaX,OAAOkB,WAAalB,OAAOiB,WAIhE,OAHAjB,OAAOY,MAAMjB,KAAKkB,SAAS,GAAGlB,KAAO2B,UACrCtB,OAAOY,MAAMnB,UAEN,GASXF,UAAUC,UAAU+B,SAAW,WAE3B,IAAIC,OAAQ,EAERC,QAAS,EACTC,QAAS,EACTC,QAAS,EACTC,QAAS,EAETC,UAAYzC,EAAE,eAAe0C,QAC7BC,UAAY3C,EAAE,eAAe0C,QAC7BE,UAAY5C,EAAE,kBAAkB0C,QAEhCG,SAAW,qBACXC,IAAM,OA2DV,OAzDA9C,EAAE+C,KAAKnC,OAAOoC,YAAY,SAASC,GAAIC,UACnC,IAAIC,MAAQD,SAASC,MAAMC,QAAQ,KAAM,KAC5B,IAATD,OACKN,SAASQ,KAAKF,SACfd,QAAS,GAETiB,OAAOH,OAAS,MAChBb,QAAS,GAETgB,OAAOH,QAAUG,OAAOR,OACxBP,QAAS,GAGbO,IAAMK,OAENX,QAAS,CAEjB,IAEIH,QACKI,UAAUc,QACXrD,IAAIsD,WAAW,WAAY,yBAAyBC,MAAK,SAASC,GAC9D1D,EAAE,6BAA6B0C,QAAQiB,OAAO,8CACxCD,EAAI,gBACd,IAEJtB,OAAQ,GACDK,UAAUc,QACjBd,UAAUmB,SAEVtB,QACKK,UAAUY,QACXrD,IAAIsD,WAAW,WAAY,yBAAyBC,MAAK,SAASC,GAC9D1D,EAAE,6BAA6B0C,QAAQiB,OAAO,8CACxCD,EAAI,gBACd,IAEJtB,OAAQ,GACDO,UAAUY,QACjBZ,UAAUiB,SAEVrB,QACKK,UAAUW,QACXrD,IAAIsD,WAAW,cAAe,yBAAyBC,MAAK,SAASC,GACjE1D,EAAE,6BAA6B0C,QAAQiB,OAAO,iDACxCD,EAAI,gBACd,IAEJtB,OAAQ,GACDQ,UAAUW,QACjBX,UAAUgB,SAGVhD,OAAOiD,OAAON,QACd3C,OAAOiD,OAAOC,KAAK,WAAY1B,OAASI,SAGpCJ,OASZjC,UAAUC,UAAU6B,SAAW,SAAS1B,MAEpC,IAAI6B,OAAQ,EACRI,QAAS,EACTuB,OAAwC,GAA/BT,OAAO/C,KAAKyD,YAAY,IACjCC,UAAYjE,EAAE,eAAe0C,QAwBjC,OAtBA1C,EAAE+C,KAAKnC,OAAOoC,YAAY,SAASC,GAAIC,UACb,IAAlBA,SAASC,QACTX,QAAS,EAEjB,KAEKA,QAAUuB,QACNE,UAAUV,QACXrD,IAAIsD,WAAW,WAAY,yBAAyBC,MAAK,SAASC,GAC9D1D,EAAE,6BAA6B0C,QAAQiB,OAAO,8CACxCD,EAAI,oCACJnD,KAAKyD,YAAY,GAAK,IAAMzD,KAAKyD,YAAY,GAAK,gBAC5D,IAEJ5B,OAAQ,GACD6B,UAAUV,QACjBU,UAAUL,SAGd5D,EAAE,gBAAgBkE,KAAK3D,KAAK4D,YAAY,GAAK,IAAM5D,KAAK4D,YAAY,GAAK,KAAO5D,KAAK4D,YAAY,GAAK,MACtGnE,EAAE,gBAAgBkE,KAAK3D,KAAKyD,YAAY,GAAK,IAAMzD,KAAKyD,YAAY,GAAK,KAAOzD,KAAKyD,YAAY,GAAK,OAE9F5B,OAGZjC,UAAUC,UAAUgE,UAAY,SAASC,SAAUrD,SAiB/Cd,IAAIoE,YAfU,CACV,CAACC,IAAK,cAAeC,UAAW,yBAChC,CAACD,IAAK,UAAWC,UAAW,yBAC5B,CAACD,IAAK,UAAWC,UAAW,yBAC5B,CAACD,IAAK,aAAcC,UAAW,yBAC/B,CAACD,IAAK,cAAeC,UAAW,yBAChC,CAACD,IAAK,eAAgBC,UAAW,yBACjC,CAACD,IAAK,cAAeC,UAAW,yBAChC,CAACD,IAAK,cAAeC,UAAW,yBAChC,CAACD,IAAK,eAAgBC,UAAW,yBACjC,CAACD,IAAK,qBAAsBC,UAAW,2BAKlBf,MAAK,SAASC,GACnC9C,OAAOY,MAAQ,IAAIZ,OAAO6D,MAAMzE,EAAE,oBAAqB,CACnD0E,KAAM,MACNnE,KAAM,CACFoE,OAAQ3D,QACRS,SAAU,CAAC,CACPlB,KAAMK,OAAOC,QACb+D,gBAAiB,UACjBC,YAAa,GAEjB,CACItE,KAAMK,OAAOiB,WACb+C,gBAAiB,UACjBC,YAAa,KAGrBnD,QAAS,CACLC,MAAO,CACHmD,SAAS,EACTlD,KAAM,CAACyC,SAAS1C,MAAO,IACvBoD,SAAU,GACVC,UAAW,UAEfC,OAAQ,CACJC,MAAO,CAAC,CACJC,MAAO,CACHC,aAAa,EAEbC,QAAS,IAEbC,WAAY,CACRR,SAAS,EACTS,YAAa7B,EAAE,GACf8B,UAAW,UACXT,SAAU,IAEdU,UAAW,CACPC,YAAY,EACZC,UAAW,GACXC,MAAO,UACPC,cAAe,aAGvBC,MAAO,CAAC,CACJR,WAAY,CACRR,SAAS,EACTS,YAAa7B,EAAE,GACf8B,UAAW,UACXT,SAAU,IAEdU,UAAW,CACPM,iBAAiB,GAGrBC,cAAe,MAGvBC,OAAQ,CACJnB,SAAS,GAEboB,QAAS,CACLC,WAAY,CACRC,OAAQ,MACRC,MAAO,MACPT,MAAO,cAK3B,KAGJ,IAAI5D,SAAW,IAAI7B,UA6OnB,OAxOA6B,SAASsE,YAAc,SAASC,QAE5BtG,IAAIuG,KAAK,yBAA0B,aAEnCC,QAAQ,CAAC,iBACT,IAAIpC,SAAWkC,OAAOhG,KAEtBK,OAAOW,KAAO,EACd,IAAIP,QAAUqD,SAASrD,QAEvBJ,OAAOC,QAAU,GACjBD,OAAOE,QAAU,GACjBF,OAAOiB,WAAa,GACpBjB,OAAOkB,WAAa,GAGpBlB,OAAOiD,OAAS7D,EADK,oBAEjBY,OAAOiD,OAAON,QACd3C,OAAOiD,OAAOC,KAAK,YAAY,GAGnC9D,EAAEe,IAAIC,SAAS,SAASC,QACpBL,OAAOC,QAAQK,KAAKmD,SAASlD,QAAQF,QAAQG,OAC7CR,OAAOE,QAAQI,KAAKmD,SAASlD,QAAQF,QAAQI,YAC7CT,OAAOiB,WAAWX,KAAKmD,SAAStC,QAAQd,QAAQG,OAChDR,OAAOkB,WAAWZ,KAAKmD,SAAStC,QAAQd,QAAQI,WACpD,IAEAT,OAAOY,MAAQ,GAEfiF,QAAQ,CAAC,oBAAoB,WACzB7F,OAAO6D,MAAMyB,QAAQQ,SAAS,CAC1BC,WAAY,SAASC,eACjB,IAAIC,IAAMD,cAAcpF,MAAMqF,IAC9BA,IAAIC,UAAY,QAChBD,IAAIE,SAAS,EAAG,EAAGH,cAAcpF,MAAMwF,MAAOJ,cAAcpF,MAAMyF,OACtE,IAEJjF,SAASoC,UAAUC,SAAUrD,QACjC,IAEA,IAEIkG,IAAM,CACNC,OAAQ,OACRC,QAAS,CACL,eAAgB,oDAEpBC,SAAU,SAASC,MAAQtF,SAAS3B,OAAOiH,KAAQ,EACnDC,IARMC,EAAEN,IAAIO,QAAU,+CAAiDpD,SAASqD,UAYnE1H,EADQ,iBACc0C,QAC5BiF,OAAO3F,UAAU,WACxB,IAAI4F,QAAU5H,EAAE,kBACZ4H,SACAA,QAAQhE,SAEZsD,IAAI3G,KAAOP,EAAE,eAAe6H,YAAc,eAC1C7H,EAAE8H,KAAKZ,IACX,IAEA,IACIa,aAAe/H,EADQ,mBACgB0C,QACvCqF,cACAA,aAAaJ,OAAO3F,UAAU,WAC1B,IAAI4F,QAAU5H,EAAE,kBACZ4H,SACAA,QAAQhE,SAEZ5D,EAAE,sBAAsB0C,QAAQoB,KAAK,QAAS,KAC9CoD,IAAI3G,KAAOP,EAAE,eAAe6H,YAAc,eAC1C7H,EAAE8H,KAAKZ,IACX,IAGJ,IACIc,gBAAkBhI,EADQ,sBACmB0C,QAC7CsF,iBACAA,gBAAgBL,OAAO3F,UAAU,WAC7B,IAAI4F,QAAU5H,EAAE,kBACZ4H,SACAA,QAAQhE,SAEZ5D,EAAE,mBAAmB0C,QAAQoB,KAAK,QAAS,KAC3CoD,IAAI3G,KAAOP,EAAE,eAAe6H,YAAc,eAC1C7H,EAAE8H,KAAKZ,IACX,IAGJtG,OAAOoC,WAAahD,EAAE,8FACtBY,OAAOoC,WAAW2E,OAAO3F,UAAU,WAC/B,IAAIiG,cACIjI,EAAE,wGACNiI,eACAA,cAAcrE,SAElB,IAAIgE,QAAU5H,EAAE,kBACZ4H,SACAA,QAAQhE,SAER5B,SAASG,aACT+E,IAAI3G,KAAOP,EAAE,eAAe6H,YAAc,eAC1C7H,EAAE8H,KAAKZ,KAEf,IAEWlH,EAAE,kCACR2H,OAAO3F,UAAU,WAElB,IAAIV,OAAQ4G,WAERC,IACAC,MAJJxH,OAAOW,KAAO8G,KAAKlF,MAKA,GAAfvC,OAAOW,MACPD,OAASV,OAAOE,QAChBoH,WAAatH,OAAOkB,WACpBqG,IAAM,UACNC,MAAQ,MAER9G,OAASV,OAAOC,QAChBqH,WAAatH,OAAOiB,WACpBsG,IAAM,UACNC,MAAQE,KAAKC,IAAID,KAAKC,IAAIC,MAAMH,KAAMzH,OAAOC,SAASyH,KAAKC,IAAIC,MAAMH,KAAMzH,OAAOiB,cAGtF3B,IAAIsD,WAAW2E,IAAK,yBAAyB1E,MAAK,SAASC,GACvD9C,OAAOY,MAAME,QAAQuD,OAAOC,MAAM,GAAGI,WAAWC,YAAc7B,EAC9D9C,OAAOY,MAAME,QAAQuD,OAAOC,MAAM,GAAGC,MAAMsD,aAAeL,MAE1DxH,OAAOY,MAAMjB,KAAKkB,SAAS,GAAGlB,KAAOe,OACrCV,OAAOY,MAAMjB,KAAKkB,SAAS,GAAGlB,KAAO2H,WACrCtH,OAAOY,MAAMnB,QACjB,GACJ,IAEWL,EAAE,6DACR0I,MAAM1G,UAAU,WACjB,IAAI2G,OAAsB,iCAAZN,KAAKpF,GAAyC,EAAI,EAC5DoF,KAAKO,SACLhI,OAAOY,MAAMjB,KAAKkB,SAASkH,QAAQE,QAAS,EAC5CjI,OAAOY,MAAMnB,WAEbO,OAAOY,MAAMjB,KAAKkB,SAASkH,QAAQE,QAAS,EAC5CjI,OAAOY,MAAMnB,SAErB,IAEA,IAAIyI,QAAU9I,EAAE,eACZ+I,YAAc/I,EAAE,eACpB8I,QAAQJ,MAAM1G,UAAU,WACpB,IACIgH,QAAU,gGADEC,SAASC,eAAe,mBAAmBC,UAAU,aACvD,0CAOdJ,YAAY,GAAGK,cAAcH,SAASI,MAAML,SAC5CM,YAAW,WAAaP,YAAY,GAAGK,cAAcG,OAAS,GAAE,IACpE,IAGYvJ,EAAE,aACR0I,MAAM1G,UAAU,WAClByE,QAAQ,CAAC,aAAa,SAAS+C,UAC3B,IAAIC,UAAYR,SAASC,eAAe,mBACpCQ,aAAeD,UAAUE,wBACzBC,WAAaF,aAAazC,OAU9BuC,SAASC,UARC,CACRI,OAAc,EACdC,SAAc,YACdC,MAAc,CAAErF,KAAM,OACtBsF,UAAc,CAAEzI,KAAM,aACtB0I,YAAc,CAAErF,gBAAiB,WACjCsF,MAAc,CAAEC,KAAM,KAAMC,OAAQ,CAPtBV,aAAa1C,MAO+B,IAAX4C,YAAiBS,YAAa,cAGnF,GACJ,IAEYrK,EAAE,aACR0I,MAAM1G,UAAU,WAElByE,QAAQ,CAAC,cACL,SAAS6D,QAETtK,EAAE,oBAAoBuK,IAAI,GAAGC,QAAO,SAASC,MACzCH,OAAOG,KAAM,YACjB,GACJ,GACJ,IAEYzK,EAAE,aACR0I,MAAM1G,UAAU,WAClByE,QAAQ,CAAC,cACL,SAAS6D,QAETtK,EAAE,oBAAoBuK,IAAI,GAAGC,QAAO,SAASC,MACzCH,OAAOG,KAAM,YAChB,GAAE,aACP,GACJ,IAEazK,EAAE,cACR0I,MAAM1G,UAAU,WACnBhC,EAAE,4BAA4B0K,IAAI,QAClC1K,EAAE,eAAe6D,QACrB,IAEY7D,EAAE,aACR0I,MAAM1G,UAAU,WAClBhC,EAAE,4BAA4B0K,IAAI,OAClC1K,EAAE,eAAe6D,QACrB,IAEY7D,EAAE,aACR0I,MAAM1G,UAAU,WAClBhC,EAAE,4BAA4B0K,IAAI,OAClC1K,EAAE,eAAe6D,QACrB,IAEA7D,EAAE,oCAAoC0I,OAAM,WACxCY,YAAW,WAAYtH,SAASG,UAAY,GAAE,IAClD,IAEAH,SAASG,YAGNH,QACX"}