define(["jquery","core/log","core/str","grade/report/gradedist/js/highcharts"],function(a,b,c,d){var e=function(){};e.prototype.update=function(b,c){if(a.data=a.parseJSON(c.responseText),1==a.data.updateall){a.absolut=[],a.percent=[],a.map(a.data.actdist,function(b){a.absolut.push(b.count),a.percent.push(b.percentage)});var d=1==a.mode?a.percent:a.absolut;a.chart.series[0].setData(d),a.chart.setTitle({text:a.data.title})}a.absolutnew=[],a.percentnew=[],a.map(a.data.newdist,function(b){a.absolutnew.push(b.count),a.percentnew.push(b.percentage)}),a.coverage(a.data);var e=1==a.mode?a.percentnew:a.absolutnew;a.chart.series[1].setData(e)},e.prototype.validate=function(){var b=!1,d=!1,e=!1,f=!1,g=!1,h=a("#b_decimals").first(),i=a("#b_interval").first(),j=a("#b_predecessor").first(),k=/^\d+([.]\d{1,2})?$/,l=100.01;return a.boundaries.each(function(a){var b=a.get("value").replace(/,/g,".");""!=b?(k.test(b)||(d=!0),Number(b)>100&&(e=!0),Number(b)>=Number(l)&&(f=!0),l=b):g=!0}),d?(h||a("#boundary_error_container").first().append('<div class="b_error" id="b_decimals"><span>'+c.getString("decimals","gradereport_gradedist")+"</span></div>"),b=!0):h&&h.remove(),e?(i||a("#boundary_error_container").first().append('<div class="b_error" id="b_interval"><span>'+c.getString("interval","gradereport_gradedist")+"</span></div>"),b=!0):i&&i.remove(),f?(j||a("#boundary_error_container").first().append('<div class="b_error" id="b_predecessor"><span>'+c.getString("predecessor","gradereport_gradedist")+"</span></div>"),b=!0):j&&j.remove(),null!==a.submit&&a.submit.set("disabled",b||g),!b},e.prototype.coverage=function(b){var d=!1,e=0!=Number(b.newcoverage[0]),f=a("#b_coverage").first();a.boundaries.each(function(a){""==a.get("value")&&(d=!0)}),!d&&e?f||a("#boundary_error_container").first().append('<div class="b_error" id="b_coverage"><span>'+c.getString("coverage","gradereport_gradedist")+'</span><span class="newcoverage">'+b.newcoverage[0]+"/"+b.newcoverage[1]+"</span></div>"):f&&f.remove(),a(".actcoverage").setContent(b.actcoverage[0]+"/"+b.actcoverage[1]+" ("+b.actcoverage[2]+"%)"),a(".newcoverage").setContent(b.newcoverage[0]+"/"+b.newcoverage[1]+" ("+b.newcoverage[2]+"%)")};var f=new e;return f.initializer=function(){b.info("Initialize settings JS","gradedist");var e=0,g=[],h=[],i=[],j=[],k=[],l=[],m="#id_submitbutton",n=a(m).first();if(n&&n.set("disabled",!0),a.map(l.actdist,function(a,b){g.push(b),h.push(a.count),i.push(a.percentage)}),a.map(l.newdist,function(a){j.push(a.count),k.push(a.percentage)}),l.highcharts)var o=new d.Chart({chart:{renderTo:"chart_container",type:"column"},title:{text:l.title},xAxis:{title:{text:c.getString("gradeletter","gradereport_gradedist")},categories:g},yAxis:{title:{text:c.getString("absolut","gradereport_gradedist")}},legend:{enabled:!1},tooltip:{enabled:!1},lang:{printChart:c.getString("printchart","gradereport_gradedist"),downloadPNG:c.getString("downloadpng","gradereport_gradedist"),downloadJPEG:c.getString("downloadjpeg","gradereport_gradedist"),downloadPDF:c.getString("downloadpdf","gradereport_gradedist"),downloadSVG:c.getString("downloadsvg","gradereport_gradedist"),contextButtonTitle:c.getString("contextbuttontitle","gradereport_gradedist")},series:[{data:h,color:"#990000",dataLabels:{enabled:!0,color:"#000000",style:{fontWeight:"normal"}}},{data:j,color:"#33cc33",dataLabels:{enabled:!0,color:"#000000",style:{fontWeight:"normal"}}}]});else{var p="#chart_container";a(p.first().setHTML("<br><p><i><strong>[ !!! "+c.getString("highchartsmissing","gradereport_gradedist")+" !!! ]</strong></i></p><br>"))}var q=M.cfg.wwwroot+"/grade/report/gradedist/ajax_handler.php?id="+l.courseid,r={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},form:{id:"letterform",useDisabled:!0,upload:!1},on:{complete:a.update}},s="id_gradeitem",t=a(s.first());t.change(f,function(){var b=a(".alert-success");b&&b.remove(),r.data="updateall=1",a.ajax({data:r.data,url:q})});var u="#id_coursegroup",v=a(u).first();v&&v.change(f,function(){var b=a(".alert-success");b&&b.remove(),r.data="updateall=1",a("#id_coursegrouping").first().set("value","0"),a.ajax({data:r.data,url:q})});var w="#id_coursegrouping",x=a(w).first();x&&x.change(f,function(){var b=a(".alert-success");b&&b.remove(),r.data="updateall=1",a("#id_coursegroup").first().set("value","0"),a.ajax({data:r.data,url:q})});var y=a(".gradeboundaries_new input[type=text], #fgroup_id_grp_gradeboundaries_new input[type=text]");y.change(f,function(){var b=a("#page-grade-report-gradedist-index .notifyproblem, #page-grade-report-gradedist-index .notifysuccess");b&&b.remove();var c=a(".alert-success");c&&c.remove(),a.validate()&&a.ajax({data:r.data,url:q})});var z=a('input[name^="grp_description"]');z.change(f,function(a){e=a.currentTarget.get("value");var b,d;1==e?(b=i,d=k,o.yAxis[0].axisTitle.attr({text:c.getString("percent","gradereport_gradedist")}),o.yAxis[0].setExtremes(0,100)):(b=h,d=j,o.yAxis[0].axisTitle.attr({text:c.getString("absolut","gradereport_gradedist")}),o.yAxis[0].setExtremes(0,null)),o.series[0].setData(b),o.series[1].setData(d)});var A=a("#id_grp_columns_actualcolumns, #id_grp_columns_newcolumns");A.click(f,function(a){var b="id_grp_columns_actualcolumns"==a.currentTarget.get("id")?0:1;a.currentTarget.get("checked")?o.series[b].show():o.series[b].hide()}),a.validate()},f});