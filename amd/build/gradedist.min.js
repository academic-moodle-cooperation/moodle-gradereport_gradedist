define ("gradereport_gradedist/gradedist",["jquery","core/log","core/str","gradereport_gradedist/config"],function(a,b,c){var d=function(){};d.prototype.update=function(b){var c=JSON.parse(b.responseText);if(1==c.updateall){window.absolut=[];window.percent=[];a.map(c.letters,function(a){window.absolut.push(c.actdist[a].count);window.percent.push(c.actdist[a].percentage)});var d=1==window.mode?window.percent:window.absolut;window.chart.data.datasets[0].data=d;window.chart.options.title.text=[c.title,""]}window.absolutnew=[];window.percentnew=[];a.map(c.letters,function(a){window.absolutnew.push(c.newdist[a].count);window.percentnew.push(c.newdist[a].percentage)});e.coverage(c);var f=1==window.mode?window.percentnew:window.absolutnew;window.chart.data.datasets[1].data=f;window.chart.update();return!0};d.prototype.validate=function(){var b=!1,d=!1,e=!1,f=!1,g=!1,h=a("#b_decimals").first(),i=a("#b_interval").first(),j=a("#b_predecessor").first(),k=/^\d+([.]\d{1,2})?$/,l=100.01;a.each(window.boundaries,function(a,b){var c=b.value.replace(/,/g,".");if(""!=c){if(!k.test(c)){d=!0}if(100<+c){e=!0}if(+c>=+l){f=!0}l=c}else{g=!0}});if(d){if(!h.length){c.get_string("decimals","gradereport_gradedist").done(function(b){a("#boundary_error_container").first().append("<div class=\"b_error\" id=\"b_decimals\"><span>"+b+"</span></div>")})}b=!0}else if(h.length){h.remove()}if(e){if(!i.length){c.get_string("interval","gradereport_gradedist").done(function(b){a("#boundary_error_container").first().append("<div class=\"b_error\" id=\"b_interval\"><span>"+b+"</span></div>")})}b=!0}else if(i.length){i.remove()}if(f){if(!j.length){c.get_string("predecessor","gradereport_gradedist").done(function(b){a("#boundary_error_container").first().append("<div class=\"b_error\" id=\"b_predecessor\"><span>"+b+"</span></div>")})}b=!0}else if(j.length){j.remove()}if(window.submit.length){window.submit.prop("disabled",b||g)}a("#id_grp_export_export").prop("disabled",!1);return!b};d.prototype.coverage=function(b){var d=!1,e=!1,f=0!=+b.newcoverage[0],g=a("#b_coverage").first();a.each(window.boundaries,function(a,b){if(""==b.value){e=!0}});if(!e&&f){if(!g.length){c.get_string("coverage","gradereport_gradedist").done(function(c){a("#boundary_error_container").first().append("<div class=\"b_error\" id=\"b_coverage\"><span>"+c+"</span><span class=\"newcoverage\">"+b.newcoverage[0]+"/"+b.newcoverage[1]+"</span></div>")})}d=!0}else if(g.length){g.remove()}a(".actcoverage").html(b.actcoverage[0]+"/"+b.actcoverage[1]+" ("+b.actcoverage[2]+"%)");a(".newcoverage").html(b.newcoverage[0]+"/"+b.newcoverage[1]+" ("+b.newcoverage[2]+"%)");return!d};d.prototype.initChart=function(b,d){c.get_strings([{key:"gradeletter",component:"gradereport_gradedist"},{key:"absolut",component:"gradereport_gradedist"},{key:"percent",component:"gradereport_gradedist"},{key:"printchart",component:"gradereport_gradedist"},{key:"downloadpng",component:"gradereport_gradedist"},{key:"downloadjpeg",component:"gradereport_gradedist"},{key:"downloadpdf",component:"gradereport_gradedist"},{key:"downloadsvg",component:"gradereport_gradedist"},{key:"downloadjpeg",component:"gradereport_gradedist"},{key:"contextbuttontitle",component:"gradereport_gradedist"}]).done(function(c){window.chart=new window.Chart(a("#chart_container"),{type:"bar",data:{labels:d,datasets:[{data:window.absolut,backgroundColor:"#990000",borderWidth:1},{data:window.absolutnew,backgroundColor:"#33cc33",borderWidth:1}]},options:{title:{display:!0,text:[b.title,""],fontSize:18,fontStyle:"normal"},scales:{yAxes:[{ticks:{beginAtZero:!0,padding:10},scaleLabel:{display:!0,labelString:c[1],fontColor:"#4d759e",fontSize:15},gridLines:{drawBorder:!1,lineWidth:.3,color:"#000000",zeroLineColor:"#c0e0d0"}}],xAxes:[{scaleLabel:{display:!0,labelString:c[0],fontColor:"#4d759e",fontSize:15},gridLines:{drawOnChartArea:!1},barPercentage:.8}]},legend:{display:!1},plugins:{datalabels:{anchor:"end",align:"top",color:"#000000"}}}})})};var e=new d;e.initializer=function(d){b.info("Initialize settings JS","gradedist");require(["canvastoBlob"]);var f=d.data;window.mode=0;var g=f.letters;window.absolut=[];window.percent=[];window.absolutnew=[];window.percentnew=[];window.submit=a("#id_submitbutton");if(window.submit.length){window.submit.prop("disabled",!0)}a.map(g,function(a){window.absolut.push(f.actdist[a].count);window.percent.push(f.actdist[a].percentage);window.absolutnew.push(f.newdist[a].count);window.percentnew.push(f.newdist[a].percentage)});window.chart=[];require(["ChartDataLabels"],function(){window.Chart.plugins.register({beforeDraw:function beforeDraw(a){var b=a.chart.ctx;b.fillStyle="white";b.fillRect(0,0,a.chart.width,a.chart.height)}});e.initChart(f,g)});var h=M.cfg.wwwroot+"/grade/report/gradedist/ajax_handler.php?id="+f.courseid,i={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},complete:function complete(a){e.update(a)},url:h},j=a("#id_gradeitem").first();j.change(e,function(){var b=a(".alert-success");if(b){b.remove()}i.data=a("#letterform").serialize()+"&updateall=1";a.ajax(i)});var k=a("#id_coursegroup").first();if(k){k.change(e,function(){var b=a(".alert-success");if(b){b.remove()}a("#id_coursegrouping").first().prop("value","0");i.data=a("#letterform").serialize()+"&updateall=1";a.ajax(i)})}var l=a("#id_coursegrouping").first();if(l){l.change(e,function(){var b=a(".alert-success");if(b){b.remove()}a("#id_coursegroup").first().prop("value","0");i.data=a("#letterform").serialize()+"&updateall=1";a.ajax(i)})}window.boundaries=a(".gradeboundaries_new input[type=text], #fgroup_id_grp_gradeboundaries_new input[type=text]");window.boundaries.change(e,function(){var b=a("#page-grade-report-gradedist-index .notifyproblem, #page-grade-report-gradedist-index .notifysuccess");if(b){b.remove()}var c=a(".alert-success");if(c){c.remove()}if(e.validate()){i.data=a("#letterform").serialize()+"&updateall=1";a.ajax(i)}});var m=a("input[name^=\"grp_description\"]");m.change(e,function(){window.mode=this.value;var a,b,d,e;if(1==window.mode){a=window.percent;b=window.percentnew;d="percent";e=100}else{a=window.absolut;b=window.absolutnew;d="absolut";e=Math.max(Math.max.apply(this,window.absolut),Math.max.apply(this,window.absolutnew))}c.get_string(d,"gradereport_gradedist").done(function(c){window.chart.options.scales.yAxes[0].scaleLabel.labelString=c;window.chart.options.scales.yAxes[0].ticks.suggestedMax=e;window.chart.data.datasets[0].data=a;window.chart.data.datasets[1].data=b;window.chart.update()})});var n=a("#id_grp_columns_actualcolumns, #id_grp_columns_newcolumns");n.click(e,function(){var a="id_grp_columns_actualcolumns"===this.id?0:1;if(this.checked){window.chart.data.datasets[a].hidden=!1;window.chart.update()}else{window.chart.data.datasets[a].hidden=!0;window.chart.update()}});var o=a(".grgd_print"),p=a("#printframe");o.click(e,function(){var a=document.getElementById("chart_container").toDataURL("image/png");p[0].contentWindow.document.write("<!DOCTYPE html><html><head><title></title><script></script></head><body onload=\"\"><img src=\""+a+"\" style=\"width: 100%;\" /></body></html>");setTimeout(function(){p[0].contentWindow.print()},200)});var q=a(".grgd_pdf");q.click(e,function(){require(["html2pdf"],function(a){var b=document.getElementById("chart_container"),c=b.getBoundingClientRect(),d=c.height,e=c.width;a(b,{margin:1,filename:"chart.pdf",image:{type:"png"},pagebreak:{mode:"avoid-all"},html2canvas:{backgroundColor:"#ffffff"},jsPDF:{unit:"px",format:[e,1.1*d],orientation:"landscape"}})})});var r=a(".grgd_png");r.click(e,function(){require(["filesaver"],function(b){a("#chart_container").get(0).toBlob(function(a){b(a,"chart.png")})})});var s=a(".grgd_jpg");s.click(e,function(){require(["filesaver"],function(b){a("#chart_container").get(0).toBlob(function(a){b(a,"chart.jpg")},"image/jpeg")})});a("#letterform input[type=\"submit\"]").click(function(){setTimeout(function(){e.validate()},1e3)});e.validate()};return e});
//# sourceMappingURL=gradedist.min.js.map
